#! /usr/bin/env python3
"""Mix the stored commits per year value into the badge for documentation."""
import json
import pathlib
import sys

DB = pathlib.Path('etc/yearly-commits.json')
ENCODING = 'utf-8'
SVG_TEMPLATE = pathlib.Path('etc/templates/commits-per-year-value.svg')
SVG_TARGET = pathlib.Path('docs/badges/commits-per-year.svg')
TOKEN = '$n$'


def main() -> int:
    """Mix the stored commits per year value into the badge for documentation."""
    with DB.open('rt', encoding=ENCODING) as handle:
        db = json.load(handle)
    commits = db.get('commits_per_year', 0)
    print(f'db({DB}) -> commits/year({commits})')

    with SVG_TEMPLATE.open('rt', encoding=ENCODING) as handle:
        svg = handle.read()

    svg = svg.replace(TOKEN, str(commits))

    with SVG_TARGET.open('wt', encoding=ENCODING) as handle:
        handle.write(svg)


if __name__ == '__main__':
    sys.exit(main())
